workflows:
  react-native-workflow:
    name: React Native Workflow
    max_build_duration: 120
    environment:
      vars:
        NODE_VERSION: 14.17.0
        EXPO_CLI_VERSION: 4.8.1
      node: $NODE_VERSION
    scripts:
      - name: Install dependencies
        script: npm install
      - name: Set up React Native environment
        script: |
          npm install -g expo-cli@$EXPO_CLI_VERSION
      - name: Build Android APK
        script: |
          expo build:android --no-wait --non-interactive
          mkdir -p $CM_BUILD_DIR/build_outputs/apk
          mv $CM_BUILD_DIR/dist/*.apk $CM_BUILD_DIR/build_outputs/apk/
      - name: Build iOS IPA
        script: |
          expo build:ios --no-wait --non-interactive
          mkdir -p $CM_BUILD_DIR/build_outputs/ipa
          mv $CM_BUILD_DIR/dist/*.ipa $CM_BUILD_DIR/build_outputs/ipa/
    artifacts:
      - build_outputs/**/*
    publishing:
      email:
        recipients:
          - shakeebjasim.mail@gmail.com
